# tgdlbot - Telegram Video Downloader Bot

Telegram –±–æ—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ —Å YouTube –∏ Instagram.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üé¨ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ —Å **YouTube** –∏ **Instagram**
- üéØ –£–º–Ω—ã–π –≤—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –º–∞–∫—Å. –∫–∞—á–µ—Å—Ç–≤–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 50MB)
- ‚úÇÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ 50MB
- üìè –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–ª–∏–º–∏—Ç Telegram API)
- üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- üóëÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- üê≥ Multi-stage Docker build
- üîß –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ª—ë–≥–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.13+
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
   ```bash
   git clone <repository-url>
   cd tgdlbot
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`**
   ```bash
   cp .env.example .env
   ```

3. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞**
   - –ù–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
   - –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env` —Ñ–∞–π–ª:
     ```
     TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
     ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞**
   ```bash
   docker-compose up -d
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**
   ```bash
   docker-compose logs -f tgdlbot
   ```

6. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞**
   ```bash
   docker-compose down
   ```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   ```bash
   uv sync --extra dev
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª** (—Å–º. –≤—ã—à–µ)

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞**
   ```bash
   uv run python bot.py
   ```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
uv run pytest tests/ -v

# –í Docker
docker-compose run tgdlbot uv run pytest tests/ -v
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/help` –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

#### YouTube
- `https://www.youtube.com/watch?v=...`
- `https://youtu.be/...`
- `https://www.youtube.com/shorts/...`

#### Instagram
- `https://www.instagram.com/p/...` (–ø–æ—Å—Ç—ã)
- `https://www.instagram.com/reel/...` (Reels)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tgdlbot/
‚îú‚îÄ‚îÄ bot.py              # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ platforms/          # –ú–æ–¥—É–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º
‚îÇ   ‚îú‚îÄ‚îÄ base.py         # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ   ‚îú‚îÄ‚îÄ youtube.py      # YouTube
‚îÇ   ‚îî‚îÄ‚îÄ instagram.py    # Instagram
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_bot.py     # –¢–µ—Å—Ç—ã –±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ platforms/      # –¢–µ—Å—Ç—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º
‚îú‚îÄ‚îÄ downloads/          # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (gitignore)
‚îú‚îÄ‚îÄ .env.example        # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml  # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ pyproject.toml      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ README.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 50MB (–ª–∏–º–∏—Ç Telegram API)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –≤–∏–¥–µ–æ (Instagram)
- –¢—Ä–µ–±—É–µ—Ç—Å—è ffmpeg –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

## –ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ

### YouTube
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å —É—á–µ—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: 1080p ‚Üí 720p ‚Üí 480p ‚Üí 360p
2. **Smart skip**: –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç 1080p/720p –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ä > 75MB
3. **–†–∞–∑–±–∏–µ–Ω–∏–µ**: –ï—Å–ª–∏ –≤–∏–¥–µ–æ > 50MB, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏

### Instagram
- –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –ª—É—á—à–µ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –µ—Å–ª–∏ > 50MB

### –ü—Ä–∏–º–µ—Ä—ã:

| –ò—Å—Ö–æ–¥–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ | –†–∞–∑–º–µ—Ä | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-------------------|--------|-----------|
| 1080p (YouTube) | 30MB | ‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ü–µ–ª–∏–∫–æ–º (1080p) |
| 1080p (YouTube) | 80MB | ‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ü–µ–ª–∏–∫–æ–º (720p –∏–ª–∏ –Ω–∏–∂–µ) |
| 720p (YouTube) | 60MB | ‚úÖ –†–∞–∑–±–∏—Ç–æ –Ω–∞ 2 —á–∞—Å—Ç–∏ –ø–æ ~45MB |
| –õ—É—á—à–µ–µ (Instagram) | 55MB | ‚úÖ –†–∞–∑–±–∏—Ç–æ –Ω–∞ 2 —á–∞—Å—Ç–∏ |

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º

–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `BasePlatform`:

```python
class BasePlatform(ABC):
    @property
    def name(self) -> str: ...

    @property
    def url_pattern(self) -> str: ...

    def is_valid_url(self, url: str) -> bool: ...

    def get_format_options(self, info: dict) -> List[Tuple[str, Optional[dict]]]: ...
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `platforms/`
2. –ù–∞—Å–ª–µ–¥—É–π—Ç–µ—Å—å –æ—Ç `BasePlatform`
3. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã
4. –î–æ–±–∞–≤—å—Ç–µ –≤ `platforms/__init__.py` –∏ `bot.py`

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
uv add package_name
```

### –ó–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
uv pip install watchfiles
uv run watchfiles python bot.py
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
